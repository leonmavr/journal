\documentclass[a4paper]{article}
\usepackage[utf8]{inputenc}


%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
% PREAMBLE
%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Important styling notes
%%
% For now, to include img.jpg in img/path/to/img.jpg, just use:
% path/to/img.jpg - for details see style.tex
\input{style.tex}




\begin{document}
%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
% GLOBAL STYLES (DOCUMENT SCOPE)
%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
% caption: Figure 1 -> <bold> Fig. 1 </bold>
\captionsetup[figure]{labelfont={bf},labelformat={default},labelsep=period,name={Fig.}}


%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
% TITLE PAGE
%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
\input{title.tex}
%\maketitle



%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
% MAIN DOCUMENT
%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
\newpage
\tableofcontents
\newpage



%------------------------------ New section ------------------------------%
\section{Projective geometry}


\subsection{Homogeneous coordinates}


\subsubsection{Motivation}
Homogeneous coordinates (H.C.) are a way of representing points and lines. In the homogeneous space, it is easier to formalise some mathematical derivations than in the Euclidean space. Homogeneous coordinates are often used in computer vision mainly in two broad applications.
\begin{enumerate}
    \item They allow us to \textit{compactly represent point transforms}. For instance, they allow us to represent the affine transform (rotation and translation) as a matrix multiplication $\by = \bA\bx$ as opposed to $\by = \textbf{R}\bx + \textbf{T}$, where $\bA$ (affine matrix) embeds $\textbf{R}$ (rotation) and $\textbf{T}$ (translation). To see why this is the case, consider the rotation and translation mapping of a point $\begin{bmatrix}x_1 & x_2 & x_3\end{bmatrix}\t$ given by:
    % ref https://math.stackexchange.com/questions/1155986/why-use-homogeneous-coordinates
    \[
        \begin{bmatrix} x_1 \\ x_2 \\ x_3 \end{bmatrix} \mapsto
        \underbrace{
            \begin{bmatrix}
            r_{11} & r_{12} & r_{13} \\
            r_{21} & r_{22} & r_{23} \\
            r_{31} & r_{32} & r_{33} \\
            \end{bmatrix}
        }
        _{\textbf{R}}
        \underbrace{\begin{bmatrix} x_1 \\ x_2 \\ x_3 \end{bmatrix} +}_{\bx}
        \underbrace{\begin{bmatrix} t_1 \\ t_2 \\ t_3 \end{bmatrix}}_{\textbf{T}}
    \]
    This can be written as a single matrix multiplication, which is more compact and also allows computer programs to optimise it.
    
    The trick is to pack \textbf{}$\textbf{R}$ and $\textbf{T}$ into one $3\times 4$ matrix $\begin{bmatrix}
    \textbf{R} \; | \; \textbf{T}
    \end{bmatrix}$ by appending $\textbf{T}$ to $\textbf{R}$:
    \[
    \begin{bmatrix}
    \textbf{R}\; | \; \textbf{T}
    \end{bmatrix} = 
    \begin{bmatrix}
        r_{11} & r_{12} & r_{13} & t_1 \\
        r_{21} & r_{22} & r_{23} & t_2 \\
        r_{31} & r_{32} & r_{33} & t_3 \\
    \end{bmatrix}
    \]
    \marginnote{We can convert a Euclidean point to hom. by appending a new extra coordinate with value 1.}This is the so-called \emphasis{affine} matrix $\textbf{A}$. However, the multiplication of $\bA$ with $\bx$ is undefined as $\bx$ is $3 \times 1$. The can augment $\bx$ to the size $4 \times 1$ by introducing a new (redundant) coordinate $x_4=1$. But now the product $\begin{bmatrix}\textbf{R}\; | \; \textbf{T}\end{bmatrix} \bx$ is of size $3 \times 1$, which certainly does not belong in the homogeneous space of the original vector of length 4. So to keep $\begin{bmatrix}\textbf{R}\; | \; \textbf{T}\end{bmatrix} \bx$  an inner operation and to satisfy $\bx_{hom} = \bI_{hom}\bx_{hom}$  we add a fourth redundant row $\begin{bmatrix} 0 & 0 & 0 & 1\end{bmatrix}$. The final matrix
    \[
    \bA =     \begin{bmatrix}
        r_{11} & r_{12} & r_{13} & t_1 \\
        r_{21} & r_{22} & r_{23} & t_2 \\
        r_{31} & r_{32} & r_{33} & t_3 \\
        0 & 0 & 0 & 1
    \end{bmatrix}
    \]
    is an \emphasis{affine} matrix. $\begin{bmatrix} x_1 & x_2 & x_3 & 1 \end{bmatrix}$ is the H.C. form the Euclidean point $\begin{bmatrix} x_1 & x_2 & x_3\end{bmatrix}$. Using the affine matrix, translation can also be expressed as part of a matrix product.
    \[
    \by = \bA\bx = 
    \begin{bmatrix}
        \begin{matrix}
            \textbf{\large{R}} \quad |  \quad \textbf{\large{T}}
        \end{matrix} \\
        \begin{matrix}
            0 & 0 & 0 & 1
        \end{matrix}
    \end{bmatrix} \bx
    \]
    
    \item They can \textit{represent points at the projective plane}, i.e. 3D points from the ``real world'' mapped into a 2D plane (screen). They can even represent points at infinity via finite scalars; without running into divisions by zero. Projections ubiquitously take place in camera models, the simplest one being a \emphasis{pinhole camera}.
    
    Camera models, such as the pinhole map a 3D point $(x,y,z)$ in the ``real world'' onto a 2D plane (camera film/screen) using linear transforms. The linear transform depends on the internal manufacturing characteristics (a.k.a. \emphasis{intrinsics}) of the camera and the externals (\emphasis{extrinsics}), such as its translation and rotation. For the pinhole model, the only intrinsic we consider is the focal length $f$\footnote{The projected coordinates are in distance units for simplicity, so that we can stick to one instrinsic -- the focal length. If they were measured in pixels, we would include two more intrinsic parameters in the matrix.}. It can be easily derived (see \ref{app:pinhole_model_deriv}) that the pinhole camera projection is described by the following transform.
    \begin{equation}
        \begin{bmatrix}
            x\prime \\
            y\prime 
        \end{bmatrix} 
        =
        \begin{bmatrix}
            \frac{fx}{z} \\
            \frac{fy}{z} 
        \end{bmatrix} = 
         \frac{1}{z}\begin{bmatrix}
            f & 0 & 0 \\
            0 & f & 0 \\
            0 & 0 & 1
        \end{bmatrix}
        \begin{bmatrix}
            x \\ y \\ z
        \end{bmatrix}
        \label{eq:pinhole_model}
    \end{equation}
    H.C. allow us to express \eqref{eq:pinhole_model} as a linear transform, hence more concisely. Although \eqref{eq:pinhole_model} is simple, camera models can get complicated.
\end{enumerate}

% src https://math.stackexchange.com/a/1156000
Apart from points, H.C. also represent lines (via their coefficients). Lines appear virtually everywhere in images (e.g. edges). Homogeneous coordinates help us answer questions about the correspondences of lines between the 3D world and the image place, such as; 
% ref https://www.youtube.com/watch?v=MQdm0Z_gNcw
\begin{itemize}
    \item Do parallel lines in the real world meet in the projection?
    \item Do angles between lines in the real world get preserved in the projection?
    \item Do straight lines stay straight?
\end{itemize}
Spoiler; the answers are yes, no, and yes (at least for the pinhole model).
\begin{figure}[H]
    \centering
    \includegraphics[height=4cm]{img/railway_tracks.png}
    \caption{Two properties of the pinhole-based projection; parallel lines that are not parallel to the horizon meet, straight lines remain straight (project to straight lines).}
    \label{fig:my_label}
\end{figure}

\subsubsection{Definition}

% https://www.youtube.com/watch?v=MQdm0Z_gNcw
\marginnote{Upright style $\textbf{\textup{x}}$ will be used for H.C. vectors and italic $\textbf{\textit{x}}$ for Euclidean.}Homogeneous coordinates are useful for representing an object up to a scale. Mathematically, if $\textbf{\textup{x}}$ represents a point in the H.C. space, then $\lambda \textbf{\textup{x}}, \; \lambda \neq 0$ must represent the same point, i.e. $\textbf{x}$ and $\lambda\textbf{x}$ must be equivalent ($\sim$) in H.C. We denote equivalencies in H.C. with $\sim$, therefore $\bx \sim \lambda \bx$. A point in the H.C. space is defined only by its direction and not by its magnitude. The H.C. for 3D points are hence defined as follows.
\begin{definition}[Homogeneous Coordinates of a 3D vector]
% ref https://www.robots.ox.ac.uk/~dwm/Courses/AIMS/AIMS-L3.pdf
A Euclidean 3D point $\bx = (x,\, y,\, z)\t$ is represented in \emphasis{homogeneous coordinates} by ANY 4-vector $(x_1,x_2,x_3,x_4)\t$ such that:
\begin{equation}
    x = \frac{x_1}{x_4}, \quad y = \frac{x_2}{x_4}, \quad z = \frac{x_3}{x_4}, \quad \textup{in \quad H.C.:} \quad
    \textbf{\textup{x}} = (x_1, x_2, x_3, x_4)\t
    \label{eq:ec_to_hc}
\end{equation}
\end{definition}
$x_4$ can attain any value. For instance for $x_4=1$ the H.C. of $(x,y,z)$ are $(x,y,z,1)$. The following lemma is therefore straightforward.
\marginnote{Converting from E.C.to H.C. is NOT unique! Converting H.C. to E.C. is unique.}
\begin{lemma}
In H.C., $\begin{bmatrix}x_1 & x_2 & x_3 & x_4\end{bmatrix}\t$ and $\lambda \begin{bmatrix}x_1 & x_2 & x_3 & x_4\end{bmatrix}\t,\; \lambda \neq 0$  represent the same point, i.e.
\begin{equation}
    \textbf{\textup{x}} \sim \lambda \textbf{\textup{x}}, \quad \textbf{\textup{x}} = \begin{bmatrix}x_1 & x_2 & x_3 & x_4\end{bmatrix}\t, \quad \lambda \neq 0
\end{equation}
\label{lem:hc_equiv}
\end{lemma}
% ref https://cg.informatik.uni-freiburg.de/course_notes/graphics_02_transformations.pdf
For example, $(2,3,4,1) \sim (6,9,12,3) \sim (2,3,4)$, and $(4,8,12,2)\sim (2,4,6)$. 

\subsubsection{Converting between Euclidean and homogeneous coordinates}

From Lemma \ref{lem:hc_equiv}, it is clear that to convert a point $(x,y,z)$ from Euclidean to H.C. we simply add one more ordinate $w=1$ and obtain $(x,y,z,1)$. From now on black dot ($\bullet$) denotes H.C. and white ($\circ$) E.C.
\begin{equation}
\begin{bmatrix}
x_1 \\ x_2 \\ x_3    
\end{bmatrix}
\laplace
\begin{bmatrix}
x_1 \\ x_2 \\ x_3 \\ 1
\end{bmatrix}
\end{equation}
% ref https://www.robots.ox.ac.uk/~dwm/Courses/AIMS/AIMS-L3.pdf
Inversely, to ``dehomogenise'' a point $(x_1,\, x_2,\, x_3,\, x_4)\t, \; x_4 \neq 0$, we first divide its elements by $x_4$ such that the last element is $1$. We then discard the last element to obtain $(x_1/x_4,\, x_2/x_4,\,  x_3/x_4)$.
\begin{equation}
\begin{bmatrix}
    x_1 \\ x_2 \\ x_3 \\ x_4
\end{bmatrix}
\Laplace
\begin{bmatrix}
    x_1/x_4 \\ x_2/x_4 \\ x_3/x_4
\end{bmatrix}, \quad x_4 \neq 0
\end{equation}
\marginnote{$\bullet$ for H.C., $\circ$ for E.C.}For example, $(1,2,3,4)\t \sim (3,6,9,12)\t \sim (-2,-4,-6,-8)\ \Laplace \ (0.25, 0.5, 0.75)$ and they all represent the 3D point Also $(0,0,2) \sim (0,0,\pi)\ \Laplace \ (0,0)$.
\begin{exmp}
% ref http://users.telenet.be/jci/math/homog.htm
Calculate the midpoint between $\textbf{\textup{p}}_1=(5,7,8)$ and $\textbf{\textup{p}}_2 = (4,-6,1)$.
\end{exmp}
\begin{soln}
\marginnote{Distance ratios are not preserved in when converting between E.C. and H.C.}
We convert to E.C. to find the midpoint.
\begin{align*}
\textbf{\textup{p}}_1 = (5,7,8)\ \Laplace \ (5/8,7/8) := \textbf{\textit{p}}_1
,\\
\textbf{\textup{p}}_2 = (4,-6,1)\ \Laplace \ (4,-6) := \textbf{\textit{p}}_2
\end{align*}
The midpoint in E.C. is $(\textbf{\textit{p}}_1 + \textbf{\textit{p}}_2)/2 = (37/16,-41/16) \  \Laplace \ (37/16, -41/16, 1) \sim (37, -41, 16) $ 
\end{soln}
% ex: \textbf{https://web.stanford.edu/class/cs231a/course_notes/01-camera-models.pdf}


\subsubsection{Geometric interpretation of homogeneous points}

If we were to convert a 2D point in E.C $(x_1, y_1)$ to H.C., we would augment:
\[
\begin{bmatrix}
x_1 \\ x_2    
\end{bmatrix}
\laplace
\begin{bmatrix}
x_1 \\ x_2  \\ 1
\end{bmatrix}
\]
Therefore in a 3D plane, the point $(x_1,x_2,1)$ in H.C. can be geometrically determined by looking at the direction $(x_1, x_2)$ and at height $x_3=1$ from the origin. Of course, because $(x_1,x_2,1) \sim \lambda(x_1,x_2,1)$, point $(x_1,x_2,1)$ is also found at $(2x_1,2x_2,2)$, $(2.5x_1,2.5x_2,2.5)$, etc. but as a convention we will be taking $x_3=1$.

Projecting onto $x_3 = 1$ helps us also find the E.C. representation of the projected point -- if $x_3=1$, then the E.C. are simply $(x_1, x_2)$. Because the projected point is expressed as $(x/w, y/w, 1)$ (Fig. \ref{fig:hc_vis_in_R3}), if we plug in $x=0,\ y=0$, then we observe that the origin $O_2(0,0)$ in E.C. gets mapped to $O_3(0,0,1)$ in H.C.
\begin{figure}[H]
    % ref left: https://www-m10.ma.tum.de/foswiki/pub/Lehre/WS0809/GeometrieKalkueleWS0809/ch3.pdf, ref middle: https://w2.mat.ucsb.edu/594cm/2010/Week1/homog-coords.pdf, ref right: https://pages.mtu.edu/~shene/COURSES/cs3621/NOTES/geometry/homo-coor.html
    \centering
    \includegraphics[width=1.08\linewidth]{img/hom_point_vis.png}
    \caption{(a): The set of homogeneous points $(x,y,z)$ in the $\setR^3$ space. (b): Numerical example of homogeneous points projected on $z=1$. (c): To project to $z=1$, we divide all ordinates by $w$.}
    \label{fig:hc_vis_in_R3}
\end{figure}


%fig: https://w2.mat.ucsb.edu/594cm/2010/Week1/homog-coords.pdf

\subsection{Mathematics of lines and points in 3D}

We have to describe the mathematics of lines in the projected space (2D) since this is what cameras use. As we will see, H.C. make it easier than Euclidean. Suppose we have a 2D point represented in E.C. as $\textit{\textit{x}} = (x,y)$. If this point lies on a line, then this line is defined by some $a_1,\, a_2,\, a_3$ such that: $a_1x + a_2y + a_3 = 0, \; a_1 \neq 0$ or $a_2\neq 0$. We can rewrite this equation for in H.C. if we convert $\textbf{\textit{x}} = (x,y) \; \laplace \;  \textbf{\textup{x}} = (x_1,x_2,x_3)$ by following \eqref{eq:ec_to_hc}:
\[
x = \frac{x_1}{x_3}, \quad y = \frac{x_2}{x_3}, \quad x_3\in \setR*
\]
% ref https://web.cs.iastate.edu/~cs577/handouts/homogeneous-coords.pdf
Then the line is written in H.C. as:
\begin{gather}
    a_1x + a_2y + a_3 = 0 \Rightarrow \nonumber \\
    a_1 \frac{x_1}{x_3} + a_2 \frac{x_2}{x_3} + a_3 = 0 \Rightarrow \nonumber \\
    a_1 x_1 + a_2 x_2 + a_3 x_3 = 0 \Rightarrow \nonumber \\
    \boldsymbol{\ell}\t \textbf{\textup{x}} = 0, \quad \boldsymbol{\ell} = (a_1,\, a_2,\, a_3)\t \nonumber
\end{gather}

\marginnote{$s\elll, \; s \in \setR^*$ and $\elll$ encode the same line.}
\begin{corollary}[line equation in H.C.]
If a 2D point  $(x,y)$ in E.C.  lies on a line parametrised by $(a_1,a_2,a_3)$, then in H.C. the line equation is described by a dot product:
\begin{equation}
    \boldsymbol{\ell}\t \textbf{\textup{x}}  = 0, \quad \boldsymbol{\ell}\t = (a_1,\, a_2,\, a_3)\t, \quad a_1,\, a_2 \neq 0
    \label{eq:line_hc}
\end{equation}
\end{corollary}
\eqref{eq:line_hc} allows us to concisely express the intersection of two lines and the line through two points.
\begin{corollary}[intersection of lines in H.C.]
Consider the two parametrised lines $\elll_1 = (a_1,a_2,a_3)\t$, $\elll_2 = (b_1,b_2,b_3)$ in H.C. Then they intersect at point $\textbf{p} = \elll_1 \times \elll_2$, where $\times$ denotes cross product.
\label{cor:inters_lines_hc}
\end{corollary}
\begin{proof}
Let $\textbf{p}$ be the point (in H.C.) where $\elll_1$ and $\elll_2$ intersect. Therefore $\textbf{p}$ satisfies the line equation \eqref{eq:line_hc} for both lines
\begin{align*}
    \textbf{p} \cdot \elll_1 = 0\\
    \textbf{p} \cdot \elll_2 = 0
\end{align*}
, where $\textbf{p} \cdot \elll_1 =\textbf{p} \t \elll_1$ is a dot product. We don't care about the magnitude of $\textbf{p}$, we only need such a vector that is perpendicular to both $\elll_1$ and $\elll_2$. Such a vector is by its definition the cross product $\elll_1\times \elll_2$, i.e.
\[
(\underbrace{\elll_1\times \elll_2}_{\textbf{p}})\cdot \elll_1 = (\underbrace{\elll_1\times \elll_2}_{\textbf{p}})\cdot \elll_2 = 0
\]
\begin{figure}[H]
    \centering
    \includegraphics[height=2cm]{img/cross_product_vis.png}
    \caption{The cross product $\ba\times \bb$ is perpendicular to both $\ba$ and $\bb$.}
    \label{fig:my_label}
\end{figure}
\end{proof}

\begin{corollary}[line joining two points in H.C.]
If $\textbf{\textup{p}}_1, \, \textbf{\textup{p}}_2$ are two points in H.C., then the coefficients of the line joining them can be computed from $\elll = \textbf{\textup{p}}_1 \times \textbf{\textup{p}}_2$.
\label{cor:line_joining_pt_hc}
\end{corollary}
\begin{proof}
We want both $\textbf{p}_1$ and $\textbf{p}_2$ to lie on the same line, i.e. satisfy its equation:
\begin{align*}
    \textbf{p}_1 \cdot \elll = 0\\
    \textbf{p}_2 \cdot \elll = 0
\end{align*}
As shown the previous proof, to satisfy these two conditions we can choose $\elll = \textbf{p}_1\times \textbf{p}_2$.
\end{proof}
Note that Cor. \ref{cor:line_joining_pt_hc} is \textit{dual} to Cor. \ref{cor:inters_lines_hc}, in the sense that points and lines are swapped. This occurs because both points and lines are represented by 3D vectors. Fig. \ref{fig:duality_vis} visualises geometrically Cor. \ref{cor:line_joining_pt_hc} and Cor. \ref{cor:inters_lines_hc} in H.C.

\begin{figure}[H]
    % ref https://www.tugraz.at/fileadmin/user_upload/Institute/ICG/Documents/courses/robotvision/2019/RV_ProjectiveGeometry.pdf
    \centering
    \includegraphics[height=3.75cm]{img/duality_vis.png}
    \caption{(a): The vector $\textbf{l}$ with the coefficients of the line joining $\textbf{p}_1, \textbf{p}_2$ is perpendicular to both $\textbf{p}_1$ and $\textbf{p}_2$ vectors, therefore perpendicular to the plane they span. (b): The same principle holds for a point $\textbf{p}$ which at the intersection of lines $\textbf{l}_1, \textbf{l}_2$.}
    \label{fig:duality_vis}
\end{figure}

% ref https://web.cs.iastate.edu/~cs577/handouts/homogeneous-coords.pdf, https://pages.mtu.edu/~shene/COURSES/cs3621/NOTES/geometry/homo-coor.html
Points at infinity $(\pm \infty, \pm \infty)$ can be represented in H.C. by finite quantities. To verify that, consider all points starting from $\textbf{\textit{r}}_0 = (x_0,y_0)$ with direction $\textbf{v} = (a,b)$. Then, points given by $\textbf{\textit{r}} = \textbf{\textit{r}}_0 + t\textbf{v},\; t\in\setR$ lie along the same straight line. Each scalar component of $\textbf{\textit{r}}$ is given by:
\begin{equation*}
    x = x_0 + ta, \quad y = y_0 + tb \tag{1}
    \label{eq:param_3d_line}
\end{equation*}
\eqref{eq:param_3d_line} is the parametric line equation of the 2D line where points $\textbf{\textit{r}} = (x,y,z) = (x_0 + ta, y_0 + tb, z_0 + tc)$ lie. In H.C., points of $\textbf{\textit{r}}$ are given by $\textbf{r} = (x_0 + ta, y_0 + tb, 1)$. Because $\textbf{r} = \textbf{r}/t$ in H.C., they are also given by:
\[
\textbf{r} = (\frac{x_0}{t} + a, \frac{y_0}{t} + b, \frac{1}{t}) 
\label{eq:line_2d_hc}
\tag{2}
\]
The E.C. points $(x_0 + ta, y_0 + tb, z_0 + tc)$ approach infinity as $t\rightarrow \infty$. If we plug in $t\rightarrow \infty$ in \eqref{eq:line_2d_hc}, it turns out the points in infinity in H.C. are given by:
\[
\textbf{r} = (a, b , 0) 
\]
 Moving in the directions of $(a,b)$ and $(-a, -b)$ will end up at the same infinity point represented by $(a,b,0)$ as well as $(-a, -b, 0)$. For instance, the points at infinity in the direction vector $\textbf{v}=(-3,2)$ are given by $(-3,2,0)$ in H.C. and all lie on the line $y=-2/3x$.
 \begin{figure}[H]
    % ref https://www.math.ucla.edu/~baker/149.1.02w/handouts/m_hcoords.pdf
     \centering
     \includegraphics[height=3.5cm]{img/points_inf_graph.png}
     \caption{Points at infinity along the direction $(-3,2)$}
 \end{figure}
\begin{corollary}[point at infinity in H.C.]
In H.C., points of the form $(a, b, 0)$ represent a point that tends to infinity in E.C. in the direction of $\textbf{v} = (a,b)$. They're also known as \emphasis{ideal points} (or \emphasis{vanishing points}).
\end{corollary}
% ref http://lear.inrialpes.fr/people/triggs/pubs/isprs96/node7.html
Ideal points all lie along the same line $\elll$. If $\elll = (l_1,l_2,l_3)$ in H.C., then all ideal points $(a,b,0)$ must satisfy
\begin{align*}
    \begin{bmatrix}l_1 & l_2 & l_3\end{bmatrix}\t \begin{bmatrix}a & b & 0\end{bmatrix} = 0 \Rightarrow
    a = 0, \quad b = 0,\quad c \in \setR
\end{align*}
Therefore all ideal points lie along the line with coefficients $(0,0,c) \sim (0,0,1)$ in H.C. To summarise:
\begin{corollary}[line at infinity]
All ideal points lie along the line $\elll_{\infty} = (0,0,1)$ in H.C. This is known as \emphasis{ideal line} (or \emphasis{vanishing line}).
\end{corollary}
Ideal points are important because that's where lines that are parallel in E.C. meet. To verify that, consider the equations of two parallel lines:
\begin{align*}
\left\{ 
\begin{matrix}
a_1x + b_1y + c_1 = 0\\
a_1x + b_1y + c_2 = 0 \\
\end{matrix}, \quad c_1 \neq c_2
\right.
\label{eq:2parallel_lines_ec}
\end{align*}
Therefore in H.C., they can be described by $\elll_1 = (a_1, b_1, c_1)$, $\elll_2 = (a_1, b_1, c_2)$. From Cor. \ref{cor:inters_lines_hc}, we know that they intersect at:
\begin{align*}
\textbf{p} &= \elll_1 \times \elll_2 \\  
&= \left|
\begin{matrix}
\textbf{i} & \textbf{j} & \textbf{k} \\
a_1 & b_1 & c_1 \\
a_1 & b_1 & c_2
\end{matrix}
\right| = \textbf{i} (b_1c_2 - b_1c_1) + \textbf{j} (a_1c_2 - a_1c1) + \textbf{k}\cdot 0 \\
&= (b_1c_2 - b_1c_1, a_1c_2 - a_1c1, 0)
\end{align*}
$(b_1c_2 - b_1c_1, a_1c_2 - a_1c1, 0)$ is an ideal point. To summarise:

\begin{corollary}[intersection of parallel lines in H.C.]
Two parallel lines in H.C., $\elll_1 = (a, b, c)$ and $\elll_2 = (a, b, d), \quad c \neq d$ intersect at an ideal point $\textbf{\textup{p}}$ (point at infinity) given by:
\begin{equation}
    \textbf{\textup{p}} = \elll_1 \times \elll_2 = (b(d-c), a(d-c), 0)
\end{equation}
\end{corollary}

In conclusion, very concept in projective geometry has its dual. If we start with a certain statement, e.g. ``The \textcolor{magenta}{\underline{line}} \textcolor{magenta}{\underline{joining}} \textcolor{magenta}{\underline{points}} $\textbf{p}_1$, $\textbf{p}_2$ is given by $\elll = \textbf{p}_1\times \textbf{p}_2$''  and take the dual of each concept, we end up with ``The \textcolor{magenta}{\underline{point}} of \textcolor{magenta}{\underline{intersection}} of  \textcolor{magenta}{\underline{lines}} $\textbf{l}_1$, $\textbf{l}_2$ is given by $\textbf{p} = \elll_1\times \elll_2$''. For completeness, the duality table is given below.
\begin{table}[h!]
\centering
 \begin{tabular}{c c} 
 \hline
 Original & Dual\\ [0.5ex] 
 \hline
 point & line \\
 join & intersect \\
 $\textbf{p}$ & $\elll$ \\
 [1ex] 
 \hline
 \end{tabular}
\end{table}

\subsubsection{Geometric interpretation of conversions between E.C. and H.C.} 
% https://medium.com/@daniel.j.lenton/part-i-projective-geometry-in-2d-b1ca26d5fa2a and TODOs

So far 2D E.C. points were described as infinite rays in the 3D Euclidean space. In this section H.C. points are described in an alternative geometrical fashion -- as straight 2D line segments. The most important thing to remember to interpret H.C. coordinates this way is that an infinite line through the origin is normal to a (3D) plane through the origin. In this section, the following are described in Euclidean space:
\begin{enumerate}
    \item H.C. points,
    \item a line intersection in H.C.,
    \item and the points of the line joining two H.C. points
\end{enumerate}

Below each case is derived geometrically.
\begin{enumerate}
    \item (\textbf{H.C. point in E.C. space}) We already know that a H.C. point $(\ell_1, \ell_2, \ell_3)$ lies anywhere along the straight line from the origin to $\lambda(\ell_1, \ell_2, \ell_3), \; \lambda \in \setR$. The line defined by the direction of $(\ell_1, \ell_2, \ell_3)$ is normal to a plane through the origin that is normal to it, i.e. to plane $\ell_1x_1 + \ell_2x_3 + \ell_3x_3 = 0$. Also, to find the Euclidean equivalent of a H.C. point, we set $x_3=1$. Ultimately, the Euclidean equivalent of the H.C. point $(\ell_1, \ell_2, \ell_3)$ is determined by the intersection of the following two planes:
    \[
    \ell_1x_1 + \ell_2x_2 + \ell_3x_3 = 0 \quad \cap \quad   x_3 - 1 = 0
    \]
    Therefore the 2D line equation that describes point $(\ell_1,\ell_2,\ell_3)$ is:
    \[
        \ell_1x_1 + \ell_2x_2 + \ell_3 = 0 
    \]
    All this is visualised in Fig. \ref{fig:geo_plane_origin} and Fig. \ref{fig:geo_point_in_line}.
\begin{figure}[H]
    \centering
    \begin{minipage}{.4\textwidth}
      \centering
      \includegraphics[width=0.7\linewidth]{img/geo_plane_origin.png}
      \captionof{figure}{The plane $\ell_1x_1 + \ell_2x_2 + \ell_3x_3 = 0$}
      \label{fig:geo_plane_origin}
    \end{minipage}%
    \begin{minipage}{.5\textwidth}
      \centering
      \includegraphics[width=.7\linewidth]{img/geo_point_in_line.png}
      \captionof{figure}{The intersection of plane$\ell_1x_1 + \ell_2x_2 + \ell_3x_3 = 0$ with $x_3=1$ describes H.C. point $(\ell_1, \ell_2, \ell_3)$ as a 2D straight line.}
      \label{fig:geo_point_in_line}
    \end{minipage}
\end{figure}

    \item (\textbf{line intersection in H.C.}) We now know that a line along point $\elll = (\ell_1, \ell_2, \ell_3)$ in H.C. can be represented as the intersection of planes $\elll\t \bx=0$, $x_3 = 1$ in the 3D space. Also the intersection of two E.C. points $\elll = (\ell_1, \ell_2, \ell_3)$, $\textbf{m} = (m_1, m_2, m_3)$ can be described as an infinite ray spanned by the cross product $\elll \times \textbf{m}$ (Cor. \ref{cor:line_joining_pt_hc}). Finally, to convert ray $\elll \times \textbf{m}$ to its E.C. equivalent, we project it onto plane $x_3=1$
    
    This is visualised in the figure below, where the red and blue planes are given, the orange ray describes their cross product, and the intersection of the orange ray with plane $x_3=1$ (which is a straight line) describes the intersection of the two lines defined by $\elll = (\ell_1, \ell_2, \ell_3)$ and  $\textbf{m} = (m_1, m_2, m_3)$ respectively. Note that the orange ray is NOT necessarily along the axis $x_3$, although the figure is misleading.
    
    \begin{figure}[H]
        \centering
        \includegraphics[height=5cm]{img/geo_intersection_of_lines.png}
        \caption{Intersection of H.C. lines $\elll = (\ell_1, \ell_2, \ell_3)$ and  $\textbf{m} = (m_1, m_2, m_3)$ described as a 2D line.}
    \end{figure}
    
    \item (\textbf{Line joining two H.C. points}) It is known from Cor. \ref{cor:line_joining_pt_hc} that if two H.C. points $\textbf{p}_1$, $\textbf{p}_2$ are given , then the coefficients of the line through them in H.C. are given by the cross product $\elll = \textbf{p}_1 \times \textbf{p}_2$. This cross product is once again a vector normal to the plane $\elll_1x_1 + \elll_2x_2 + \elll_3x_3 = 0$. To unproject the plane $\elll\t\bx=0$ in 2D, we project it onto $x_3=1$. The line projected onto $x_3=1$ describes the line through $\textbf{p}_1$ and $\textbf{p}_2$ in 2D.
    \begin{figure}[H]
        \centering
        \includegraphics[height=5cm]{img/geo_line_two_points.png}
        \caption{The intersection of the plane $(\textbf{p}_1\textbf{p}_2)\t\bx=0$ with $x_3=1$ describes the line through H.C. points $\textbf{p}_1$ and $\textbf{p}_2$.}
    \end{figure}


\end{enumerate}




\subsection{The cross ratio}

\subsubsection{The maths of cross ratio}

An important quantity that lets us convert scene (real world, 3D) distance measurements to image distance measurements (pixels) and vice versa is the cross ratio. The most important property of the cross ratio is that it remains invariant under the perspective projection.

\begin{definition}[cross ratio of points]
The cross ratio of 4 collinear points $A,B,C,D$ is defined as:
\begin{equation}
    CR(A,B;C,D) = \frac{\frac{CA}{CB}}{\frac{DA}{DB}}
    \label{eq:cross_ratio_points}
\end{equation}
, where $CA, CB, DA, DB$ are \textit{signed} distances, i.e. each one depends on the direction of the line they lie at.
\end{definition}
\begin{figure}[H]
    \centering
    \includegraphics[height=2cm]{img/cross_ratio_4_points.png}
    \caption{The quantities that appear in the cross ratio $CR(A,B;C,D)$.}
\end{figure}
Obviously, the cross ratio does not depend on the direction of the line but it depends on the relative orienration of the 4 points. The cross ratio also does not depend on the choice of the projective coordinate system (it only involves distances). To remember \eqref{eq:cross_ratio_points}, think of the double ratio fraction as a $4\times 2$ matrix of 4 letters. On the first column ($CR(A,B;\ldots)$), the letter changes every row. On the second column ($CR(\ldots;C,D)$), it changes two rows.

The cross ratio has a number of interesting properties but they will not be discussed. We will only prove that it is invariant under the projective transform. However, before getting to the main point, it is helpful to the \textit{cross ratio of 4 concurrent lines}.
\begin{definition}[cross ratio of lines]
Given 4 concurrent lines $a,b,c,d$ that meet a point $M$, the cross ratio of those lines as:
\begin{equation}
    CR(a,b;c,d) = \frac{\frac{\sin(c\hat{M}a)}{\sin(c\hat{M}b)}}
    {\frac{\sin(d\hat{M}a)}{\sin(d\hat{M}b)}}
\end{equation}
\end{definition}
We can show that given 4 collinear points $A,B,C,D$ and a centre of projection $M$, the cross ratio of points $CR(A,B;C,D)$ and the cross ratio of segments $a=MA,b=MB,c=MC,d=MD$ $CR(a,b;c,d)$ are equal.
\begin{lemma}[CR of points equals CR of segments]
Given 4 collinear points $A,B,C,D$, then
\begin{gather}
    CR(A,B;C,D) = CR(a,b;c,d) \Longleftrightarrow \nonumber \\
    \frac{\frac{CA}{CB}}{\frac{DA}{DB}} = \frac{\frac{\sin(c\hat{M}a)}{\sin(c\hat{M}b)}}  {\frac{\sin(d\hat{M}a)}{\sin(d\hat{M}b)}}
    \label{eq:cr_points_equals_cr_lines}
\end{gather}
\end{lemma}
\begin{figure}[H]
    \centering
    \includegraphics[height=4cm]{img/cross_ratio_points_lines.png}
    \caption{4 collinear points, their point of intersection $M$ and the lines to $M$.}
\end{figure}
\begin{proof}
We express the area of each triangle in two different ways:
\begin{align*}
area(CMA) = \frac{1}{2}MC \cdot MA  \sin(C\hat{M}A) = \frac{h}{2} CA \\
area(CMB) = \frac{1}{2}MC \cdot MB  \sin(C\hat{M}B) = \frac{h}{2} CB \\
area(DMA) = \frac{1}{2}MD \cdot MA  \sin(D\hat{M}A) = \frac{h}{2} DA \\
area(DMB) = \frac{1}{2}MD \cdot MB  \sin(D\hat{M}B) = \frac{h}{2} DB
\end{align*}
Then the cross ratio of distances is written as:
\begin{align*}
CR(a,b;c,d) = \frac{\frac{\sin(c\hat{M}a)}{\sin(c\hat{M}b)}} {\frac{\sin(d\hat{M}a)}{\sin(d\hat{M}b)}} = \\
\frac{\frac{h/2\ CA/(MC\cdot MA)}{h/2\ CB/(MC\cdot MB)}}
{\frac{h/2\ DA/(MD\cdot MA)}{h/2\ DB/(MD\cdot MB)}} = \frac{\frac{CA}{CB}}{\frac{DA}{DB}}
\end{align*}
\end{proof}

We now have enough background to prove the main theorem.
\begin{theorem}[perspective transform preserves the cross ratio]
Any 4 points forming a pencil with common base have the same cross ratio. It is equal to the cross ratio of the base points.
\begin{figure}[H]
    \centering
    \includegraphics[height=4.5cm]{img/cross_ratio_pencils.png}
    \caption{$CR(P_1,P_2;P_3,P_4) = CR(P_5,P_6,P_7,P_8) =CR(Q_1,Q_2,Q_3,Q_4) = CR(Q_5,Q_6,Q_7,Q_8) = CR(A,B,C,D)$}
    \label{fig:cross_ratio_pencil}
\end{figure}
For the sets of points in Fig. \ref{fig:cross_ratio_pencil}, the theorem states that:
\begin{equation}
    CR(P_1,P_2;P_3,P_4) = CR(P_5,P_6;P_7,P_8) =CR(Q_1,Q_2;Q_3,Q_4) = CR(Q_5,Q_6;Q_7,Q_8) = CR(A,B;C,D)
\end{equation}
In other words, the cross ratio remains invariant under projective transformations.
\end{theorem}
\begin{proof}
We proof the theorem for the green points first. We know from \eqref{eq:cr_points_equals_cr_lines} that:
\begin{gather}
CR(P_1,P_2;P_3,P_4) =
\frac{\frac{\sin(P_3\hat{M}P_1)}{\sin(P_3\hat{M}P_2)}}   {\frac{\sin(P_4\hat{M}P_1)}{\sin(P_4\hat{M}P_2)}} = 
\frac{\frac{\sin(P_7\hat{M}P_5)}{\sin(P_8\hat{M}P_6)}}   {\frac{\sin(P_8\hat{M}P_5)}{\sin(P_8\hat{M}P_6)}} = 
CR(P_5,P_6;P_7,P_8) \Rightarrow \\
CR(P_1,P_2;P_3,P_4) = CR(P_5,P_6;P_7,P_8) \tag{1}
\end{gather}
, as $P_i$ and $P_{i+4}$ lie on the same line hence the sines are equal. In exactly the same way, it can be proven that:
\begin{gather}
CR(P_1,P_2;P_3,P_4) = CR(A,B,C,D)  \tag{2}  
\end{gather}
Similarly:
\begin{gather}
CR(Q_1,Q_2;Q_3,Q_4) = CR(Q_5,Q_6;Q_7,Q_8) \tag{3}
\end{gather}
From Eq. (1), (2), (3) we can derive the theorem:
\[
CR(P_1,P_2;P_3,P_4) = CR(P_5,P_6;P_7,P_8) = CR(A,B;C,D) = CR(Q_1,Q_2;Q_3,Q_4) = CR(Q_5,Q_6;Q_7,Q_8) 
\]
\end{proof}


\subsubsection{Cross ratio and single view metrology}

Cross ratio helps relate distances in the 3D world ($xyz$ scene plane, e.g. in cm, m, or km) with distances in the image ($xy$ image plane, e.g. in pixels). Inferring real-world measurements from image measurements is called \emphasis{single-view metrology}.

Suppose we are given the image in pixels on the right and want to know how far the car is from the crossroad in the real world. We have measured that $A'D'=300\; px$, $A'C'=275 \; px$ and $B'C'=50\; px$. We want to know $CD$.
\begin{figure}[H]
    \centering
    \includegraphics[height=5.5cm]{img/cross_ratio_crossroad.png}
    \caption{An aerial view of a crossroad (left) and its image under the perspective transform of a camera (right).}
    \label{fig:my_label}
\end{figure}
$A'$, $B'$, $C'$, $D'$ are the projections of $A,B,C,D$ on the ground plane therefore we can use the cross ratio preservation theorem:
\begin{gather*}
\frac{A'C'}{A'D'}:\frac{B'C'}{B'D'} = \frac{AC}{AD}:\frac{BC}{BD} \Rightarrow\\
\frac{275}{300}:\frac{50}{A'D' - A'C'} = \frac{275}{300}:\frac{50}{75} = \frac{AC}{AD}:\frac{BC}{BD}  \Rightarrow \\
\frac{AC}{AD}:\frac{BC}{BD} =1.375
\end{gather*}
However, $AC=4-CD$, $BC=2-CD$ therefore:
\[
\frac{4-CD}{4}:\frac{2-CD}{2} = 1.375 \Rightarrow CD = 0.857 \; km
\]

\marginnote{In the image plane, the vanishing point(s) can be determined as the intersection of two lines that are parallel in the real world.}If we know that  a point in the scene is a vanishing point, i.e. at infinity, then inferring distances in the scene is even easier. For instance, in the picture below, point $D'$ in the scene plane is at horizon of this plane, i.e. at infinity (also called vanishing point). When mapped to $D$ in the image plane, it is at the horizon of the image, which is the vanishing line. The latter is a finite point. Note that $D'$ in the image plane is at the intersection of lines $A'C'$ and $\ell$, which are parallel in the real world but meet at a vanishing point in the image plane (Fig. \ref{fig:tiles_perspective}).

\begin{figure}[H]
    \centering
    \includegraphics[height=3.5cm]{img/tiles_horizon.png}
    \caption{Some square tiles in the image plane under perspective transform.}
    \label{fig:tiles_perspective}
\end{figure}

Then, using the cross ratio theorem for the scene (points $A,B,C,D$, not shown) and image planes (Fig. \ref{fig:tiles_perspective}) we get:
\[
\frac{AC}{AD}:\frac{BC}{BD}  = \frac{A'C'}{A'D'}:\frac{B'C'}{B'D'} = 
\]
However, $AD/BD = \norm{\textbf{r}_A - \textbf{r}_D}/\norm{\textbf{r}_B - \textbf{r}_D}$ and as $\textbf{r}_D \rightarrow \infty$ then $\lim_{\textbf{r}_B\rightarrow \infty} \norm{\textbf{r}_A - \textbf{r}_D}/\norm{\textbf{r}_B - \textbf{r}_D} = 1$ therefore the cross ratio in the scene plane is re-written as $\frac{AC}{AD}:\frac{BC}{BD} = \frac{AC}{BC}$.
\begin{corollary}[cross ratio including vanishing point]
If $A,B,C,D$ are some scene (real-world) points and $D$ is a vanishing point, i.e. at infinity, then their cross ratio can be simplified such that it does not take $D$ into account:
\begin{equation}
    \frac{A'C'}{A'D'}:\frac{B'C'}{B'D'} = \frac{AC}{BC}, \quad \textbf{r}_D\rightarrow \infty
    \label{eq:cross_ratio_vanishing_point}
\end{equation}
\end{corollary}
Revisiting the train position inference problem, knowing that a point is vanishing allows to measure distances in the real world with only one reference distances.
\begin{figure}[H]
    % ref https://www.coursera.org/lecture/robotics-perception/cross-ratios-and-single-view-metrology-AV44m
    \centering
    \includegraphics[height=4cm]{img/train_metrology_vanishing_point.png}
    \caption{To find the position of the train in the real world, we only need a vanishing point and the distance $A'D'$.}
\end{figure}


\subsubsection{Cross ratio and height forensics}

Cross ratio given a vanishing point, as in \eqref{eq:cross_ratio_vanishing_point},is the main step of inferring the height of an object in an image given the height of another object as reference. Before explain how this is done, remember that points in parallel lines in the scene plane lie on the \textit{same} line in the image plane.

Suppose the we want to infer the height of the man in black hat in the image below given the height of the statue.

\begin{figure}[H]
    \centering
    \includegraphics[height=4cm]{img/metrology_painting_1.png}
    \caption{The height $H$ of a person to be determined given the reference height $h$ of the statue.}
\end{figure}

We break the solution in several steps. Dashed points denote the scene and non-dashed the image.

\begin{enumerate}
    \item (\textbf{Find the vanishing line in the image}). To find the vanishing line, take the intersection of two lines that are obviously parallel in the scene. The horizontal line through that intersection is the vanishing line (horizon). All vanishing points lie along that line.
    \begin{figure}[H]
        \centering
        \includegraphics[height=4cm]{img/metrology_painting_2.png}
        \caption{Finding the vanishing line.}
    \end{figure}
    \item (\textbf{Find a vanishing point}) We then find a vanishing point defined by the objects of interest. For that, we need a line in the real world that connects two parallel objects -- in this case the feet. We intersect that line with the horizon to find the vanishing point A.
    \begin{figure}[H]
        \centering
        \includegraphics[height=4cm]{img/metrology_painting_3.png}
        \caption{Finding the vanishing line.}
    \end{figure}
    \item (\textbf{Distance transfer}) We know $h=B'C'$ in the scene plane, e.g. $179\; cm$. We transfer the known height $h$ onto the unknown object. Draw one more line from the vanishing point $A$ through the top $C$ of the known object and intersect it with the vertical of the unknown object at $E$. Because $A,C,E$ or on the same line in the image, they're paallel in the scene. Likewise for $A,B,D$. Therefore in the scene $D'E' = B'C' = h$. But $D'E'$ is not the full height of the unkown object. We know $D'E'$ and want $D'F'$.
    \begin{figure}[H]
        \centering
        \includegraphics[height=4cm]{img/metrology_painting_4.png}
        \caption{Transferring the height of the known object onto the unknown one.}
    \end{figure}
    \item (\textbf{Find the vertical vanishing point and use the cross ratio}) To find the height of the man, we want to know $D'E'/D'F'$. If the horizon is not in the middle, lines $BC$ and $DF$ are not actually parallel in the image plane, but they meet at a finite point $V$. $V$ is therefore the intersection of $BC$ and $DF$.
        \begin{figure}[H]
        \centering
        \includegraphics[height=6cm]{img/metrology_painting_5.png}
        \caption{Lines $BC$ and $DF$ interesect at the vertical vanishing point $V$.}
        \label{fig:height_measurement_distance_transfer}
    \end{figure}
    $V'$ is at infinity in the scene plane. Therefore if we use \eqref{eq:cross_ratio_vanishing_point} then we can determine ratio $D'E'/D'F'$ (knowing $D'E'=h$):
    \begin{gather*}
        \frac{D'E'}{D'F'} = \frac{DE}{DF} : \frac{VE}{VF} \Rightarrow
        D'F' =  \frac{1}{D'E'} \frac{VE}{VF} : \frac{DE}{DF} \Rightarrow
        H = \frac{1}{h} \frac{VE}{VF} : \frac{DE}{DF}
    \end{gather*}
\end{enumerate}
\begin{corollary}[height measurement via distance transfer]
If we are given an image of a reference object of height $h=B'C'$ in the scene, then we can determine the height $H$ (in the scene) of an unknown object by the formula:
\begin{equation}
    H = \frac{1}{h} \frac{VE}{VF} : \frac{DE}{DF}
\end{equation}
Points $V,E,F,D$ are marked in Fig. \ref{fig:height_measurement_distance_transfer}.
\end{corollary}

These are the core steps height measurement via perspective. Additionally, point $V$ can be cross-produced as $\textbf{v}=\overrightarrow{DF}\times \overrightarrow{BC}$ as in Cor. \ref{cor:inters_lines_hc}, finding the horizon can be automated by Hough lines, or the algorithm can be semi-supervised by allowing the user to click at pixels in order to define lines.

% http://cs.rkmvu.ac.in/~sghosh/public_html/bhu_igga/tute.pdf
%http://www.ipb.uni-bonn.de/html/teaching/3dcs-ge-2020/stachniss/2020-3dcs-02-homogeneous-coords-4.pdf
%https://beckassets.blob.core.windows.net/product/readingsample/6715665/9783642172854_excerpt_001.pdf
% https://teaching.csse.uwa.edu.au/units/CITS4402/lectures/Lecture09-ProjectiveGeometry.pdf
% http://users.umiacs.umd.edu/~ramani/cmsc828d/ProjectiveGeometry.pdf
% https://teaching.csse.uwa.edu.au/units/CITS4402/lectures/Lecture09-ProjectiveGeometry.pdf
% https://filebox.ece.vt.edu/~jbhuang/teaching/ece5554-4554/fa17/lectures/Lecture_12_CalibrationAndMetrology.pdf
% https://mi.eng.cam.ac.uk/~cipolla/lectures/4F12/Examples/4F12-examples-2.pdf
% https://sci-hub.se/https://doi.org/10.1080/0025570X.2006.11953376
% https://math.stackexchange.com/questions/1022879/geometric-interpretation-of-the-cross-ratio
% http://math.mit.edu/~notzeb/cross.pdf
% https://www.cut-the-knot.org/pythagoras/Cross-Ratio.shtml
% https://www.coursera.org/lecture/robotics-perception/cross-ratios-and-single-view-metrology-AV44m


%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
% References
%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
\newpage
\printbibliography



%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
% Appendices
%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
\newpage
\appendix

\section{Appendices}

% ------------------------ New appendix ------------------------ %
\newpage
\subsection{Pinhole camera model derivation}
\label{app:pinhole_model_deriv}

%\lstinputlisting[language=python,caption={A code listing (\detokenize{src/foo_bar.py)}.}, label=src:mylabel]{src/foo_bar.py}
   Consider the case of a \textit{pinhole camera}, which consists of a box which a tiny aperture on the front plane and a film which captures the energy (colour) of the light on the real plane (Fig. \ref{fig:pinhole_model}). We assume that all light rays entering the camera meet at the aperture (centre of projection). The horizontal distance between the aperture and the film is called \emphasis{focal length} $f$.
    \begin{figure}[H]
        \centering
        \includegraphics[height=6cm]{img/pinhole_model.png}
        \caption{Left: Pinhole camera schematic in 3D. Right: Pinhole camera model of a tree in the $y$ dimension.}
        \label{fig:pinhole_model}
    \end{figure}

    From the similar triangles in front and behind the screen in Fig. \ref{fig:pinhole_model}, we obtain for the project $y\prime$ of the object:
    \marginnote{The position $(x',y')$ on the screen is measured in distance units -- not pixels.}
    \[
        \frac{y}{z} = \frac{y\prime}{f} \Rightarrow y\prime = f\frac{y}{z}
    \]
    Similarly for the projected $x\prime$ (not shown in Fig. \ref{fig:pinhole_model}) we obtain:
    \[
        x\prime = f\frac{x}{z}
    \]
    To reiterate, pinhole camera performs the following linear mapping in Caertesian coordinates:
    \[
        \begin{bmatrix}
            x \\ y \\ z
        \end{bmatrix} \mapsto
        \begin{bmatrix}
            \frac{fx}{z} \\
            \frac{fy}{z} 
        \end{bmatrix}, \qquad 
        \begin{bmatrix}
            \frac{fx}{z} \\
            \frac{fy}{z} 
        \end{bmatrix} = 
         \frac{1}{z}\begin{bmatrix}
            f & 0 & 0 \\
            0 & f & 0 \\
            0 & 0 & 1
        \end{bmatrix}
        \begin{bmatrix}
            x \\ y \\ z
        \end{bmatrix}
        \]


\end{document}